!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("rxjs")):"function"==typeof define&&define.amd?define("yamapng",["exports","@angular/core","rxjs"],e):e(t.yamapng={},t.ng.core,t.rxjs)}(this,function(t,n,e){"use strict";var r=function(){function t(){}return t.decorators=[{type:n.Injectable,args:[{providedIn:"root"}]}],t.ctorParameters=function(){return[]},t.ngInjectableDef=n.defineInjectable({factory:function(){return new t},token:t,providedIn:"root"}),t}(),o=function(){function t(){}return t.prototype.ngOnInit=function(){},t.decorators=[{type:n.Component,args:[{selector:"lib-yamapng",template:"\n    <p>\n      yamapng works!\n    </p>\n  "}]}],t.ctorParameters=function(){return[]},t}(),a=function(){function t(){}return t.decorators=[{type:n.NgModule,args:[{declarations:[o],imports:[],exports:[o]}]}],t}();function i(t,e){var n="function"==typeof Symbol&&t[Symbol.iterator];if(!n)return t;var r,o,a=n.call(t),i=[];try{for(;(void 0===e||0<e--)&&!(r=a.next()).done;)i.push(r.value)}catch(s){o={error:s}}finally{try{r&&!r.done&&(n=a["return"])&&n.call(a)}finally{if(o)throw o.error}}return i}var s=function(){function t(){}return t.prototype.getNativeWindow=function(){return window},t}(),p=function(){function t(){}return t.prototype.getNativeDocument=function(){return document},t}(),c=[s,p],u=new n.InjectionToken("angular-ya-maps MAPS_API_CONFIG"),l=function(){function t(t,e,n){void 0===t&&(t=null),this.config=t,this._windowRef=e,this._documentRef=n}return t.prototype.load=function(){var n=this._documentRef.getNativeDocument().createElement("script");return n.type="text/javascript",n.async=!1,n.defer=!0,n.id="YaScript",n.src="https://api-maps.yandex.ru/2.1/?apikey="+this.config.apiKey+"&lang=ru_RU",this._scriptLoadingPromise=new Promise(function(t,e){n.onload=function(){t()},n.onerror=function(t){e()}}),this._documentRef.getNativeDocument().body.appendChild(n),this._scriptLoadingPromise},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:undefined,decorators:[{type:n.Optional},{type:n.Inject,args:[u]}]},{type:s},{type:p}]},t}(),d=function(){function t(t,e,n){var r=this;this._loader=t,this._zone=e,this._documentRef=n,this._map=new Promise(function(t){r._mapResolver=t})}return t.prototype.createMap=function(n,r){var o=this;return this._loader.load().then(function(){var e=function(){return setTimeout(function(){if(ymaps.Map){var t=new ymaps.Map(n,r);o._mapResolver(t)}else e()},100)};e()})["catch"](function(t){return console.log(t)})},t.prototype.setCenter=function(e,n){this._map.then(function(t){t.setCenter([e,n])})},t.prototype.getCenter=function(){return this._map.then(function(t){return t.getCenter()})},t.prototype.panTo=function(e,n){this._map.then(function(t){t.panTo(e,n)})},t.prototype.subscribeToMapEvent=function(n){var r=this;return e.Observable.create(function(e){r._map.then(function(t){t.events.add(n,function(t){r._zone.run(function(){return e.next(t)})})})})},t.prototype.createMarker=function(n){return this._map.then(function(t){var e=new ymaps.Placemark([n.latitude,n.longitude],{balloonContentHeader:n.balloonContentHeader,balloonContentBody:n.balloonContentBody,balloonContentFooter:n.balloonContentFooter,iconContent:n.iconContent},{draggable:n.draggable,preset:n.preset,iconLayout:n.iconLayout,iconImageHref:n.iconImageHref,iconImageSize:n.iconImageSize,iconImageOffset:n.iconImageOffset});return t.geoObjects.add(e),e})},t.prototype.removeGeo=function(e){this._map.then(function(t){t.geoObjects.remove(e)})},t.prototype.createClaster=function(r){return this._map.then(function(t){if(0!==r.markers.length){var n;n=new Array,r.markers.forEach(function(t){var e=new ymaps.GeoObject({geometry:{type:t.type,coordinates:[t.lat,t.lng]}});n.push(e)});var e=new ymaps.Clusterer({});return e.add(n),t.geoObjects.add(e),e}})},t.prototype.createObjectManager=function(n){return this._map.then(function(t){if(0!==n.datasource.length){var e=new ymaps.ObjectManager({clusterize:n.clusterize,gridSize:n.gridSize});return e.add(n.datasource),e.objects.options.set("preset",n.objectPreset),e.clusters.options.set("preset",n.clasterPreset),t.geoObjects.add(e),e}})},t.prototype.navigateToGeoObject=function(t,e){var n=t.objects.getById(e);n&&(this.setCenter(n.geometry.coordinates[0],n.geometry.coordinates[1]),t.objects.balloon.open(e))},t.prototype.checkYaSciptLoaded=function(){return this._documentRef.getNativeDocument().getElementById("YaScript")},t.prototype.objectManagerSetFilter=function(t,e){t.setFilter(e)},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:l},{type:n.NgZone},{type:p}]},t}(),h=function(){function t(t,e){this._mapsWrapper=t,this._zone=e,this._markers=new Map}return t.prototype.deleteMarker=function(e){var n=this,t=this._markers.get(e);return null==t?Promise.resolve():t.then(function(t){return n._zone.run(function(){n.getNativeMarker(e).then(function(t){n._mapsWrapper.removeGeo(t),n._markers["delete"](e)})})})},t.prototype.addMarker=function(t){var e=this._mapsWrapper.createMarker(t);this._markers.set(t,e)},t.prototype.showBalloon=function(t){this.getNativeMarker(t).then(function(t){t.balloon.open()})},t.prototype.getNativeMarker=function(t){return this._markers.get(t)},t.prototype.createEventObservable=function(n,t){var r=this;return e.Observable.create(function(e){r._markers.get(t).then(function(t){t.events.add(n,function(t){return r._zone.run(function(){return e.next(t)})})})})},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:d},{type:n.NgZone}]},t}(),f=0,m=function(){function t(t){this._markerManager=t,this.draggable=!1,this.preset="islands#blueIcon",this.markerClick=new n.EventEmitter,this.dragEnd=new n.EventEmitter,this._markerAddedToManger=!1,this._observableSubscriptions=[],this._id=(f++).toString()}return t.prototype.ngOnChanges=function(t){if(!this._markerAddedToManger)return this._markerManager.addMarker(this),this._markerAddedToManger=!0,void this._addEventListeners();t.showInfo&&this._markerManager.showBalloon(this)},t.prototype.ngOnDestroy=function(){this._markerManager.deleteMarker(this),this._observableSubscriptions.forEach(function(t){return t.unsubscribe()})},t.prototype._addEventListeners=function(){var n=this,t=this._markerManager.createEventObservable("click",this).subscribe(function(){n._markerManager.showBalloon(n),n.markerClick.emit(null)});this._observableSubscriptions.push(t);var e=this._markerManager.createEventObservable("dragend",this).subscribe(function(t){var e=t.get("target").geometry.getCoordinates();n._markerManager.getNativeMarker(n).then(function(t){n.dragEnd.emit({lat:e[0],lng:e[1],nativeMarker:t})})});this._observableSubscriptions.push(e)},t.decorators=[{type:n.Directive,args:[{selector:"ya-marker",providers:[d]}]}],t.ctorParameters=function(){return[{type:h}]},t.propDecorators={latitude:[{type:n.Input}],longitude:[{type:n.Input}],balloonLayout:[{type:n.Input}],balloonContentHeader:[{type:n.Input}],balloonContentBody:[{type:n.Input}],balloonContentFooter:[{type:n.Input}],draggable:[{type:n.Input}],preset:[{type:n.Input}],iconContent:[{type:n.Input}],showInfo:[{type:n.Input}],iconLayout:[{type:n.Input}],iconImageHref:[{type:n.Input}],iconImageSize:[{type:n.Input}],iconImageOffset:[{type:n.Input}],markerClick:[{type:n.Output}],dragEnd:[{type:n.Output}]},t}(),g=function(){function t(t,e){this._mapsWrapper=t,this._zone=e,this._clasters=new Map}return t.prototype.addClaster=function(t){var e=this._mapsWrapper.createClaster(t);this._clasters.set(t,e)},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:d},{type:n.NgZone}]},t}(),y=0,b=function(){function t(t){this._clasterManager=t,this._markerAddedToManger=!1,this._id=(y++).toString()}return t.prototype.ngOnChanges=function(t){this._markerAddedToManger||this._clasterManager.addClaster(this)},t.prototype.ngOnDestroy=function(){},t.prototype._addEventListeners=function(){},t.decorators=[{type:n.Directive,args:[{selector:"ya-claster",providers:[d]}]}],t.ctorParameters=function(){return[{type:g}]},t.propDecorators={markers:[{type:n.Input}]},t}(),v=function(){function t(t,e){this._mapsWrapper=t,this._zone=e,this._managers=new Map}return t.prototype.add=function(t){var e=this._mapsWrapper.createObjectManager(t);this._managers.set(t,e)},t.prototype.navigateToGeoObject=function(t,e){var n=this;this.getNativeManager(t).then(function(t){n._mapsWrapper.navigateToGeoObject(t,e)})},t.prototype.getNativeManager=function(t){return this._managers.get(t)},t.prototype.setFilter=function(t,e){var n=this;this.getNativeManager(t).then(function(t){n._mapsWrapper.objectManagerSetFilter(t,e)})},t.decorators=[{type:n.Injectable}],t.ctorParameters=function(){return[{type:d},{type:n.NgZone}]},t}(),_=0,I=function(){function t(t){this._manager=t,this.clusterize=!1,this.clasterPreset="islands#blueIcon",this.objectPreset="islands#blueClusterIcons",this.gridSize=0,this._observableSubscriptions=[],this._addedToManger=!1,this._id=(_++).toString()}return t.prototype.ngOnChanges=function(t){if(!this._addedToManger)return this._manager.add(this),void(this._addedToManger=!0);t.selectedObjectId&&this._manager.navigateToGeoObject(this,this.selectedObjectId),t.filter&&this._manager.setFilter(this,this.filter)},t.decorators=[{type:n.Directive,args:[{selector:"ya-object-manager",providers:[d]}]}],t.ctorParameters=function(){return[{type:v}]},t.propDecorators={clusterize:[{type:n.Input}],datasource:[{type:n.Input}],clasterPreset:[{type:n.Input}],objectPreset:[{type:n.Input}],gridSize:[{type:n.Input}],selectedObjectId:[{type:n.Input}],filter:[{type:n.Input}]},t}(),M=function(){function t(t,e){this._elem=t,this._mapsWrapper=e,this.longitude=0,this.latitude=0,this.zoom=8,this.mapType="yandex#map",this.controls=null,this.mapClick=new n.EventEmitter,this.actionTick=new n.EventEmitter,this.mapInit=!1,this._observableSubscriptions=[]}return t.prototype.ngOnInit=function(){console.log("map iit");var t=this._elem.nativeElement.querySelector(".map-container-inner");this._initMapInstance(t),this.mapInit=!0},t.prototype.ngOnChanges=function(t){this.mapInit&&(this.updatePosition(t),this.panTo(t))},t.prototype._initMapInstance=function(t){null!=this.controls?this._mapsWrapper.createMap(t,{center:[this.latitude,this.longitude],zoom:this.zoom,type:this.mapType,controls:this.controls}):this._mapsWrapper.createMap(t,{center:[this.latitude,this.longitude],zoom:this.zoom,type:this.mapType}),this._handleMapMouseEvents()},t.prototype.updatePosition=function(t){null==t.latitude&&null==t.longitude||this._mapsWrapper.setCenter(this.latitude,this.longitude)},t.prototype.panTo=function(t){null!=t.panToObjects&&this._mapsWrapper.panTo(this.panToObjects.points,this.panToObjects.params)},t.prototype._handleMapMouseEvents=function(){var o=this,t=[{name:"click",emitter:this.mapClick}],e=[{name:"actiontick",emitter:this.actionTick}];t.forEach(function(r){var t=o._mapsWrapper.subscribeToMapEvent(r.name).subscribe(function(t){var e=t.get("coords"),n={lat:e[0],lng:e[1]};r.emitter.emit(n)});o._observableSubscriptions.push(t)}),e.forEach(function(n){var t=o._mapsWrapper.subscribeToMapEvent(n.name).subscribe(function(t){o._mapsWrapper.getCenter().then(function(t){o.latitude=t[0],o.longitude=t[1];var e={lat:t[0],lng:t[1]};n.emitter.emit(e)})});o._observableSubscriptions.push(t)})},t.decorators=[{type:n.Component,args:[{selector:"ya-map",providers:[d,h,g,v],template:'\n    <div class="map-container-inner" id="map" >\n      <ng-content></ng-content>\n    </div>\n  '}]}],t.ctorParameters=function(){return[{type:n.ElementRef},{type:d}]},t.propDecorators={longitude:[{type:n.Input}],latitude:[{type:n.Input}],zoom:[{type:n.Input}],minZoom:[{type:n.Input}],maxZoom:[{type:n.Input}],mapType:[{type:n.Input}],controls:[{type:n.Input}],panToObjects:[{type:n.Input}],mapClick:[{type:n.Output}],actionTick:[{type:n.Output}]},t}();function k(){return[M,m,b,I]}var j=function(){function e(){}return e.forRoot=function(t){return{ngModule:e,providers:function n(){for(var t=[],e=0;e<arguments.length;e++)t=t.concat(i(arguments[e]));return t}(c,[{provide:l,useClass:l},{provide:u,useValue:t}])}},e.decorators=[{type:n.NgModule,args:[{declarations:k(),exports:k()}]}],e}();t.YamapngService=r,t.YamapngComponent=o,t.YamapngModule=a,t.coreDirectives=k,t.YaCoreModuleForRoot=function C(t){return[j.forRoot(t)]},t.YaCoreModule=j,t.yandex=void 0,t.ɵl=b,t.ɵk=m,t.ɵm=I,t.ɵa=M,t.ɵi=g,t.ɵh=h,t.ɵj=v,t.ɵc=u,t.ɵd=l,t.ɵg=c,t.ɵf=p,t.ɵe=s,t.ɵb=d,Object.defineProperty(t,"__esModule",{value:!0})});
//# sourceMappingURL=yamapng.umd.min.js.map
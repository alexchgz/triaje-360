/**
 * @fileoverview added by tsickle
 * @suppress {checkTypes,extraRequire,missingReturn,unusedPrivateMembers,uselessCode} checked by tsc
 */
import { Component, ElementRef, EventEmitter, Input, Output } from '@angular/core';
import { YaMapsAPIWrapper } from '../ya-maps-api-wrapper';
import { MarkerManager } from '../services/managers/marker-manager';
import { ClasterManager } from '../services/managers/claster-manager';
import { ObjectManagerManager } from '../services/managers/objectManager-manager';
import * as mapTypes from '../ya-maps-types';
// tslint:disable-next-line:component-class-suffix
export class YaMap {
    /**
     * @param {?} _elem
     * @param {?} _mapsWrapper
     */
    constructor(_elem, _mapsWrapper) {
        this._elem = _elem;
        this._mapsWrapper = _mapsWrapper;
        this.longitude = 0;
        this.latitude = 0;
        this.zoom = 8;
        this.mapType = 'yandex#map';
        this.controls = null;
        // tslint:disable-next-line:max-line-length
        this.mapClick = new EventEmitter();
        this.actionTick = new EventEmitter();
        this.mapInit = false;
        this._observableSubscriptions = [];
    }
    /**
     * @return {?}
     */
    ngOnInit() {
        console.log('map iit');
        /** @type {?} */
        const container = this._elem.nativeElement.querySelector('.map-container-inner');
        this._initMapInstance(container);
        this.mapInit = true;
    }
    /**
     * @param {?} changes
     * @return {?}
     */
    ngOnChanges(changes) {
        if (this.mapInit) {
            this.updatePosition(changes);
            this.panTo(changes);
        }
    }
    /**
     * @private
     * @param {?} el
     * @return {?}
     */
    _initMapInstance(el) {
        if (this.controls != null) {
            this._mapsWrapper.createMap(el, {
                center: [this.latitude, this.longitude], zoom: this.zoom, type: this.mapType,
                controls: this.controls
            });
        }
        else {
            this._mapsWrapper.createMap(el, {
                center: [this.latitude, this.longitude], zoom: this.zoom, type: this.mapType
            });
        }
        this._handleMapMouseEvents();
    }
    /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    updatePosition(changes) {
        if (changes['latitude'] == null && changes['longitude'] == null) {
            return;
        }
        this._mapsWrapper.setCenter(this.latitude, this.longitude);
    }
    /**
     * @private
     * @param {?} changes
     * @return {?}
     */
    panTo(changes) {
        if (changes['panToObjects'] == null) {
            return;
        }
        this._mapsWrapper.panTo(this.panToObjects.points, this.panToObjects.params);
    }
    /**
     * @private
     * @return {?}
     */
    _handleMapMouseEvents() {
        /**
         * @record
         */
        function Emitter() { }
        if (false) {
            /**
             * @param {?} value
             * @return {?}
             */
            Emitter.prototype.emit = function (value) { };
        }
        /**
         * @record
         */
        function Event() { }
        if (false) {
            /** @type {?} */
            Event.prototype.name;
            /** @type {?} */
            Event.prototype.emitter;
        }
        /** @type {?} */
        const clickEvents = [
            { name: 'click', emitter: this.mapClick }
        ];
        /** @type {?} */
        const events = [
            { name: 'actiontick', emitter: this.actionTick }
        ];
        clickEvents.forEach((e) => {
            /** @type {?} */
            const s = this._mapsWrapper.subscribeToMapEvent(e.name).subscribe((event) => {
                /** @type {?} */
                const coords = event.get('coords');
                /** @type {?} */
                const value = (/** @type {?} */ ({ lat: coords[0], lng: coords[1] }));
                e.emitter.emit(value);
            });
            this._observableSubscriptions.push(s);
        });
        events.forEach((e) => {
            /** @type {?} */
            const s = this._mapsWrapper.subscribeToMapEvent(e.name).subscribe((event) => {
                this._mapsWrapper.getCenter().then((coords) => {
                    this.latitude = coords[0];
                    this.longitude = coords[1];
                    /** @type {?} */
                    const value = (/** @type {?} */ ({ lat: coords[0], lng: coords[1] }));
                    e.emitter.emit(value);
                });
            });
            this._observableSubscriptions.push(s);
        });
    }
}
YaMap.decorators = [
    { type: Component, args: [{
                // tslint:disable-next-line:component-selector
                selector: 'ya-map',
                providers: [
                    YaMapsAPIWrapper,
                    MarkerManager,
                    ClasterManager,
                    ObjectManagerManager
                ],
                template: `
    <div class="map-container-inner" id="map" >
      <ng-content></ng-content>
    </div>
  `
            }] }
];
/** @nocollapse */
YaMap.ctorParameters = () => [
    { type: ElementRef },
    { type: YaMapsAPIWrapper }
];
YaMap.propDecorators = {
    longitude: [{ type: Input }],
    latitude: [{ type: Input }],
    zoom: [{ type: Input }],
    minZoom: [{ type: Input }],
    maxZoom: [{ type: Input }],
    mapType: [{ type: Input }],
    controls: [{ type: Input }],
    panToObjects: [{ type: Input }],
    mapClick: [{ type: Output }],
    actionTick: [{ type: Output }]
};
if (false) {
    /** @type {?} */
    YaMap.prototype.longitude;
    /** @type {?} */
    YaMap.prototype.latitude;
    /** @type {?} */
    YaMap.prototype.zoom;
    /** @type {?} */
    YaMap.prototype.minZoom;
    /** @type {?} */
    YaMap.prototype.maxZoom;
    /** @type {?} */
    YaMap.prototype.mapType;
    /** @type {?} */
    YaMap.prototype.controls;
    /** @type {?} */
    YaMap.prototype.panToObjects;
    /** @type {?} */
    YaMap.prototype.mapClick;
    /** @type {?} */
    YaMap.prototype.actionTick;
    /** @type {?} */
    YaMap.prototype.mapInit;
    /**
     * @type {?}
     * @private
     */
    YaMap.prototype._observableSubscriptions;
    /**
     * @type {?}
     * @private
     */
    YaMap.prototype._elem;
    /**
     * @type {?}
     * @private
     */
    YaMap.prototype._mapsWrapper;
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoieW1hcC5qcyIsInNvdXJjZVJvb3QiOiJuZzovL3lhbWFwbmcvIiwic291cmNlcyI6WyJsaWIvZGlyZWN0aXZlcy95bWFwLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7QUFBQSxPQUFPLEVBQ0wsU0FBUyxFQUNULFVBQVUsRUFDVixZQUFZLEVBS1osS0FBSyxFQUNMLE1BQU0sRUFBRSxNQUFNLGVBQWUsQ0FBQztBQUdoQyxPQUFPLEVBQUUsZ0JBQWdCLEVBQUUsTUFBTSx3QkFBd0IsQ0FBQztBQUMxRCxPQUFPLEVBQUUsYUFBYSxFQUFFLE1BQU0scUNBQXFDLENBQUM7QUFDcEUsT0FBTyxFQUFFLGNBQWMsRUFBRSxNQUFNLHNDQUFzQyxDQUFDO0FBQ3RFLE9BQU8sRUFBRSxvQkFBb0IsRUFBRSxNQUFNLDRDQUE0QyxDQUFDO0FBQ2xGLE9BQU8sS0FBSyxRQUFRLE1BQU0sa0JBQWtCLENBQUM7QUFpQjdDLGtEQUFrRDtBQUNsRCxNQUFNLE9BQU8sS0FBSzs7Ozs7SUFrQmhCLFlBQW9CLEtBQWlCLEVBQVUsWUFBOEI7UUFBekQsVUFBSyxHQUFMLEtBQUssQ0FBWTtRQUFVLGlCQUFZLEdBQVosWUFBWSxDQUFrQjtRQWhCN0QsY0FBUyxHQUFHLENBQUMsQ0FBQztRQUNkLGFBQVEsR0FBRyxDQUFDLENBQUM7UUFDYixTQUFJLEdBQUcsQ0FBQyxDQUFDO1FBR1QsWUFBTyxHQUFRLFlBQVksQ0FBQztRQUM1QixhQUFRLEdBQVUsSUFBSSxDQUFDOztRQUd0QixhQUFRLEdBQThDLElBQUksWUFBWSxFQUErQixDQUFDO1FBQ3RHLGVBQVUsR0FBOEMsSUFBSSxZQUFZLEVBQStCLENBQUM7UUFFbEgsWUFBTyxHQUFHLEtBQUssQ0FBQztRQUVmLDZCQUF3QixHQUFtQixFQUFFLENBQUM7SUFFMkIsQ0FBQzs7OztJQUUzRSxRQUFRO1FBQ2IsT0FBTyxDQUFDLEdBQUcsQ0FBQyxTQUFTLENBQUMsQ0FBQzs7Y0FDakIsU0FBUyxHQUFHLElBQUksQ0FBQyxLQUFLLENBQUMs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LEtBQUs7dUJBQ0wsS0FBSzttQkFDTCxLQUFLO3NCQUNMLEtBQUs7c0JBQ0wsS0FBSztzQkFDTCxLQUFLO3VCQUNMLEtBQUs7MkJBQ0wsS0FBSzt1QkFFTCxNQUFNO3lCQUNOLE1BQU07Ozs7SUFWUCwwQkFBOEI7O0lBQzlCLHlCQUE2Qjs7SUFDN0IscUJBQXlCOztJQUN6Qix3QkFBZ0M7O0lBQ2hDLHdCQUFnQzs7SUFDaEMsd0JBQTRDOztJQUM1Qyx5QkFBdUM7O0lBQ3ZDLDZCQUFvRDs7SUFFcEQseUJBQXVIOztJQUN2SCwyQkFBeUg7O0lBRXpILHdCQUF1Qjs7Ozs7SUFFdkIseUNBQXNEOzs7OztJQUUxQyxzQkFBeUI7Ozs7O0lBQUUsNkJBQXNDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHtcbiAgQ29tcG9uZW50LFxuICBFbGVtZW50UmVmLFxuICBFdmVudEVtaXR0ZXIsXG4gIE9uQ2hhbmdlcyxcbiAgT25EZXN0cm95LFxuICBPbkluaXQsXG4gIFNpbXBsZUNoYW5nZXMsXG4gIElucHV0LFxuICBPdXRwdXQgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7IFN1YnNjcmlwdGlvbiB9IGZyb20gJ3J4anMnO1xuXG5pbXBvcnQgeyBZYU1hcHNBUElXcmFwcGVyIH0gZnJvbSAnLi4veWEtbWFwcy1hcGktd3JhcHBlcic7XG5pbXBvcnQgeyBNYXJrZXJNYW5hZ2VyIH0gZnJvbSAnLi4vc2VydmljZXMvbWFuYWdlcnMvbWFya2VyLW1hbmFnZXInO1xuaW1wb3J0IHsgQ2xhc3Rlck1hbmFnZXIgfSBmcm9tICcuLi9zZXJ2aWNlcy9tYW5hZ2Vycy9jbGFzdGVyLW1hbmFnZXInO1xuaW1wb3J0IHsgT2JqZWN0TWFuYWdlck1hbmFnZXIgfSBmcm9tICcuLi9zZXJ2aWNlcy9tYW5hZ2Vycy9vYmplY3RNYW5hZ2VyLW1hbmFnZXInO1xuaW1wb3J0ICogYXMgbWFwVHlwZXMgZnJvbSAnLi4veWEtbWFwcy10eXBlcyc7XG5cbkBDb21wb25lbnQoe1xuICAvLyB0c2xpbnQ6ZGlzYWJsZS1uZXh0LWxpbmU6Y29tcG9uZW50LXNlbGVjdG9yXG4gIHNlbGVjdG9yOiAneWEtbWFwJyxcbiAgcHJvdmlkZXJzOiBbXG4gICAgWWFNYXBzQVBJV3JhcHBlcixcbiAgICBNYXJrZXJNYW5hZ2VyLFxuICAgIENsYXN0ZXJNYW5hZ2VyLFxuICAgIE9iamVjdE1hbmFnZXJNYW5hZ2VyXG4gIF0sXG4gIHRlbXBsYXRlOiBgXG4gICAgPGRpdiBjbGFzcz1cIm1hcC1jb250YWluZXItaW5uZXJcIiBpZD1cIm1hcFwiID5cbiAgICAgIDxuZy1jb250ZW50PjwvbmctY29udGVudD5cbiAgICA8L2Rpdj5cbiAgYFxufSlcbi8vIHRzbGludDpkaXNhYmxlLW5leHQtbGluZTpjb21wb25lbnQtY2xhc3Mtc3VmZml4XG5leHBvcnQgY2xhc3MgWWFNYXAgaW1wbGVtZW50cyBPbkluaXQsIE9uQ2hhbmdlcyB7XG5cbiAgQElucHV0KCkgcHVibGljIGxvbmdpdHVkZSA9IDA7XG4gIEBJbnB1dCgpIHB1YmxpYyBsYXRpdHVkZSA9IDA7XG4gIEBJbnB1dCgpIHB1YmxpYyB6b29tID0gODtcbiAgQElucHV0KCkgcHVibGljIG1pblpvb206IG51bWJlcjtcbiAgQElucHV0KCkgcHVibGljIG1heFpvb206IG51bWJlcjtcbiAgQElucHV0KCkgcHVibGljIG1hcFR5cGU6IGFueSA9ICd5YW5kZXgjbWFwJztcbiAgQElucHV0KCkgcHVibGljIGNvbnRyb2xzOiBhbnlbXSA9IG51bGw7XG4gIEBJbnB1dCgpIHB1YmxpYyBwYW5Ub09iamVjdHM6IG1hcFR5cGVzLlBhblRvT2JqZWN0cztcbiAgLy8gdHNsaW50OmRpc2FibGUtbmV4dC1saW5lOm1heC1saW5lLWxlbmd0aFxuICBAT3V0cHV0KCkgcHVibGljIG1hcENsaWNrOiBFdmVudEVtaXR0ZXI8bWFwVHlwZXMuTWFwQ2xpY2tNb3VzZUV2ZW50PiA9IG5ldyBFdmVudEVtaXR0ZXI8bWFwVHlwZXMuTWFwQ2xpY2tNb3VzZUV2ZW50PigpO1xuICBAT3V0cHV0KCkgcHVibGljIGFjdGlvblRpY2s6IEV2ZW50RW1pdHRlcjxtYXBUeXBlcy5NYXBDbGlja01vdXNlRXZlbnQ+ID0gbmV3IEV2ZW50RW1pdHRlcjxtYXBUeXBlcy5NYXBDbGlja01vdXNlRXZlbnQ+KCk7XG5cbiAgcHVibGljIG1hcEluaXQgPSBmYWxzZTtcblxuICBwcml2YXRlIF9vYnNlcnZhYmxlU3Vic2NyaXB0aW9uczogU3Vic2NyaXB0aW9uW10gPSBbXTtcblxuICBjb25zdHJ1Y3Rvcihwcml2YXRlIF9lbGVtOiBFbGVtZW50UmVmLCBwcml2YXRlIF9tYXBzV3JhcHBlcjogWWFNYXBzQVBJV3JhcHBlcikgeyB9XG5cbiAgcHVibGljIG5nT25Jbml0KCkge1xuICAgIGNvbnNvbGUubG9nKCdtYXAgaWl0Jyk7XG4gICAgY29uc3QgY29udGFpbmVyID0gdGhpcy5fZWxlbS5uYXRpdmVFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoJy5tYXAtY29udGFpbmVyLWlubmVyJyk7XG4gICAgdGhpcy5faW5pdE1hcEluc3RhbmNlKGNvbnRhaW5lcik7XG4gICAgdGhpcy5tYXBJbml0ID0gdHJ1ZTtcbiAgfVxuXG4gIHB1YmxpYyBuZ09uQ2hhbmdlcyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgaWYgKHRoaXMubWFwSW5pdCkge1xuICAgICAgdGhpcy51cGRhdGVQb3NpdGlvbihjaGFuZ2VzKTtcbiAgICAgIHRoaXMucGFuVG8oY2hhbmdlcyk7XG4gICAgfVxuICB9XG5cbiAgcHJpdmF0ZSBfaW5pdE1hcEluc3RhbmNlKGVsOiBIVE1MRWxlbWVudCkge1xuICAgIGlmICh0aGlzLmNvbnRyb2xzICE9IG51bGwpIHtcbiAgICAgIHRoaXMuX21hcHNXcmFwcGVyLmNyZWF0ZU1hcChlbCwge1xuICAgICAgICBjZW50ZXI6IFt0aGlzLmxhdGl0dWRlLCB0aGlzLmxvbmdpdHVkZV0sIHpvb206IHRoaXMuem9vbSwgdHlwZTogdGhpcy5tYXBUeXBlLFxuICAgICAgICBjb250cm9sczogdGhpcy5jb250cm9sc1xuICAgICAgfSk7XG5cbiAgICB9IGVsc2Uge1xuICAgICAgdGhpcy5fbWFwc1dyYXBwZXIuY3JlYXRlTWFwKGVsLCB7XG4gICAgICAgIGNlbnRlcjogW3RoaXMubGF0aXR1ZGUsIHRoaXMubG9uZ2l0dWRlXSwgem9vbTogdGhpcy56b29tLCB0eXBlOiB0aGlzLm1hcFR5cGVcbiAgICAgIH0pO1xuXG4gICAgfVxuXG4gICAgdGhpcy5faGFuZGxlTWFwTW91c2VFdmVudHMoKTtcbiAgfVxuXG4gIHByaXZhdGUgdXBkYXRlUG9zaXRpb24oY2hhbmdlczogU2ltcGxlQ2hhbmdlcykge1xuICAgIGlmIChjaGFuZ2VzWydsYXRpdHVkZSddID09IG51bGwgJiYgY2hhbmdlc1snbG9uZ2l0dWRlJ10gPT0gbnVsbCkge1xuICAgICAgcmV0dXJuO1xuICAgIH1cbiAgICB0aGlzLl9tYXBzV3JhcHBlci5zZXRDZW50ZXIodGhpcy5sYXRpdHVkZSwgdGhpcy5sb25naXR1ZGUpO1xuICB9XG5cbiAgcHJpdmF0ZSBwYW5UbyhjaGFuZ2VzOiBTaW1wbGVDaGFuZ2VzKSB7XG4gICAgaWYgKGNoYW5nZXNbJ3BhblRvT2JqZWN0cyddID09IG51bGwpIHtcbiAgICAgIHJldHVybjtcbiAgICB9XG4gICAgdGhpcy5fbWFwc1dyYXBwZXIucGFuVG8odGhpcy5wYW5Ub09iamVjdHMucG9pbnRzLCB0aGlzLnBhblRvT2JqZWN0cy5wYXJhbXMpO1xuICB9XG5cbiAgcHJpdmF0ZSBfaGFuZGxlTWFwTW91c2VFdmVudHMoKSB7XG4gICAgaW50ZXJmYWNlIEVtaXR0ZXIge1xuICAgICAgZW1pdCh2YWx1ZTogYW55KTogdm9pZDtcbiAgICB9XG4gICAgaW50ZXJmYWNlIEV2ZW50IHsgbmFtZTogc3RyaW5nOyBlbWl0dGVyOiBFbWl0dGVyOyB9XG5cbiAgICBjb25zdCBjbGlja0V2ZW50czogRXZlbnRbXSA9IFtcbiAgICAgIHsgbmFtZTogJ2NsaWNrJywgZW1pdHRlcjogdGhpcy5tYXBDbGljayB9XG4gICAgXTtcbiAgICBjb25zdCBldmVudHM6IEV2ZW50W10gPSBbXG4gICAgICB7IG5hbWU6ICdhY3Rpb250aWNrJywgZW1pdHRlcjogdGhpcy5hY3Rpb25UaWNrIH1cbiAgICBdO1xuXG4gICAgY2xpY2tFdmVudHMuZm9yRWFjaCgoZTogRXZlbnQpID0+IHtcbiAgICAgIGNvbnN0IHMgPSB0aGlzLl9tYXBzV3JhcHBlci5zdWJzY3JpYmVUb01hcEV2ZW50PHsgbGF0TG5nOiBhbnkgfT4oZS5uYW1lKS5zdWJzY3JpYmUoXG4gICAgICAgIChldmVudDogYW55KSA9PiB7XG4gICAgICAgICAgY29uc3QgY29vcmRzID0gZXZlbnQuZ2V0KCdjb29yZHMnKTtcbiAgICAgICAgICBjb25zdCB2YWx1ZSA9IHsgbGF0OiBjb29yZHNbMF0sIGxuZzogY29vcmRzWzFdIH0gYXMgbWFwVHlwZXMuTWFwQ2xpY2tNb3VzZUV2ZW50O1xuICAgICAgICAgIGUuZW1pdHRlci5lbWl0KHZhbHVlKTtcbiAgICAgICAgfSk7XG4gICAgICB0aGlzLl9vYnNlcnZhYmxlU3Vic2NyaXB0aW9ucy5wdXNoKHMpO1xuICAgIH0pO1xuXG4gICAgZXZlbnRzLmZvckVhY2goKGU6IEV2ZW50KSA9PiB7XG4gICAgICBjb25zdCBzID0gdGhpcy5fbWFwc1dyYXBwZXIuc3Vic2NyaWJlVG9NYXBFdmVudDx7IGxhdExuZzogYW55IH0+KGUubmFtZSkuc3Vic2NyaWJlKFxuICAgICAgICAoZXZlbnQ6IGFueSkgPT4ge1xuXG4gICAgICAgICAgdGhpcy5fbWFwc1dyYXBwZXIuZ2V0Q2VudGVyKCkudGhlbigoY29vcmRzOiBhbnkpID0+IHtcbiAgICAgICAgICAgIHRoaXMubGF0aXR1ZGUgPSBjb29yZHNbMF07XG4gICAgICAgICAgICB0aGlzLmxvbmdpdHVkZSA9IGNvb3Jkc1sxXTtcbiAgICAgICAgICAgIGNvbnN0IHZhbHVlID0geyBsYXQ6IGNvb3Jkc1swXSwgbG5nOiBjb29yZHNbMV0gfSBhcyBtYXBUeXBlcy5NYXBDbGlja01vdXNlRXZlbnQ7XG4gICAgICAgICAgICBlLmVtaXR0ZXIuZW1pdCh2YWx1ZSk7XG4gICAgICAgICAgfSk7XG5cbiAgICAgICAgfSk7XG4gICAgICB0aGlzLl9vYnNlcnZhYmxlU3Vic2NyaXB0aW9ucy5wdXNoKHMpO1xuICAgIH0pO1xuXG4gIH1cbn1cblxuaW1wb3J0IHsgTmdNb2R1bGUgfSBmcm9tICdAYW5ndWxhci9jb3JlJztcblxuXG4iXX0=